package com.jworks.kanjiquest.japanese

object JapaneseTextUtil {

    // CJK Unified Ideographs: U+4E00 - U+9FFF
    // CJK Extension A: U+3400 - U+4DBF
    private val KANJI_RANGE = Regex("[\\u4E00-\\u9FFF\\u3400-\\u4DBF]")

    // Hiragana: U+3040 - U+309F
    private val HIRAGANA_RANGE = Regex("[\\u3040-\\u309F]")

    // Katakana: U+30A0 - U+30FF
    private val KATAKANA_RANGE = Regex("[\\u30A0-\\u30FF]")

    // Any Japanese character (kanji, hiragana, katakana)
    private val JAPANESE_RANGE = Regex("[\\u3040-\\u309F\\u30A0-\\u30FF\\u4E00-\\u9FFF\\u3400-\\u4DBF]")

    fun containsKanji(text: String): Boolean = KANJI_RANGE.containsMatchIn(text)

    fun containsJapanese(text: String): Boolean = JAPANESE_RANGE.containsMatchIn(text)

    fun containsHiragana(text: String): Boolean = HIRAGANA_RANGE.containsMatchIn(text)

    fun containsKatakana(text: String): Boolean = KATAKANA_RANGE.containsMatchIn(text)

    fun isKanji(char: Char): Boolean = char in '\u4E00'..'\u9FFF' || char in '\u3400'..'\u4DBF'

    fun isHiragana(char: Char): Boolean = char in '\u3040'..'\u309F'

    fun isKatakana(char: Char): Boolean = char in '\u30A0'..'\u30FF'

    fun kanjiCount(text: String): Int = KANJI_RANGE.findAll(text).count()

    fun extractKanji(text: String): List<Char> = text.filter { isKanji(it) }.toList()

    fun japaneseRatio(text: String): Float {
        if (text.isEmpty()) return 0f
        val jpChars = JAPANESE_RANGE.findAll(text).count()
        return jpChars.toFloat() / text.length
    }

    fun katakanaToHiragana(text: String): String {
        val sb = StringBuilder()
        for (ch in text) {
            if (ch in '\u30A1'..'\u30F6') {
                sb.append((ch.code - 0x60).toChar())
            } else {
                sb.append(ch)
            }
        }
        return sb.toString()
    }

    fun hiraganaToKatakana(text: String): String {
        val sb = StringBuilder()
        for (ch in text) {
            if (ch in '\u3041'..'\u3096') {
                sb.append((ch.code + 0x60).toChar())
            } else {
                sb.append(ch)
            }
        }
        return sb.toString()
    }
}
